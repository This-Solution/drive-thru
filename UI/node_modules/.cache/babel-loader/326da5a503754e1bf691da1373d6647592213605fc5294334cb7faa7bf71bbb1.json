{"ast":null,"code":"var _jsxFileName = \"/home/harshad/OrderKey-Hub/drive-thru/UI/src/App.js\",\n  _s = $RefreshSig$();\nimport { useEffect, useState } from 'react';\nimport jwtDecode from 'jwt-decode';\nimport { useDispatch, useSelector } from 'react-redux';\n\n// Global Imports\nimport 'service/AxiosService';\n\n// Project Imports\nimport { Box, CircularProgress, Typography } from '@mui/material';\nimport Snackbar from 'components/@extended/Snackbar';\nimport Locales from 'components/Locales';\nimport ScrollTop from 'components/ScrollTop';\nimport Routes from 'routes';\nimport ApiService from 'service/ApiService';\nimport { setAuthDetail, setFlavour, setTokens } from 'store/reducers/auth';\nimport ThemeCustomization from 'themes';\nimport utils from 'utils/utils';\nimport { setCameraConfig, setTenant } from 'store/reducers/lookup';\nimport { openSnackbar } from 'store/reducers/snackbar';\nimport useConfig from 'hooks/useConfig';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst App = () => {\n  _s();\n  const dispatch = useDispatch();\n  const {\n    isLoading\n  } = useSelector(state => state.auth);\n  const [isTokenChecked, setIsTokenChecked] = useState(isLoading);\n  const {\n    onChangePresetColor\n  } = useConfig();\n  useEffect(() => {\n    getTentant();\n    bindInitData(false);\n    window.addEventListener('message', handleMessage);\n    return () => window.removeEventListener('message', handleMessage);\n  }, []);\n  const getTentant = async () => {\n    const {\n      data\n    } = await ApiService.getTenantsAsync();\n    if (data) {\n      dispatch(setTenant({\n        tenants: data\n      }));\n    }\n  };\n  const handleMessage = async event => {\n    if (event.data.refreshToken && event.data.flavour) {\n      dispatch(setFlavour({\n        flavour: event.data.flavour\n      }));\n      utils.setItemToStorage('flavour', JSON.stringify(event.data.flavour));\n      await renewSession(event.data.refreshToken);\n      bindInitData(true);\n      onChangePresetColor(`theme1`);\n    }\n  };\n  const renewSession = async refreshToken => {\n    try {\n      const {\n        data,\n        error\n      } = await ApiService.renewSessionAsync({\n        refreshToken\n      });\n      if (data) {\n        const token = {\n          session: data.sessionToken,\n          refresh: data.refreshToken\n        };\n        utils.setTokensToStorage(token);\n        localStorage.setItem('phone', data.user.phone);\n        const currentTokenUser = jwtDecode(token.session);\n        dispatch(setAuthDetail({\n          user: currentTokenUser,\n          token\n        }));\n      } else if (error) {\n        showMessage(error.email, 'error');\n      }\n    } catch (error) {\n      console.debug('generate session token issue : ', error);\n    } finally {\n      setIsTokenChecked(false);\n    }\n  };\n  const bindInitData = async isSSO => {\n    const token = utils.getTokensFromStorage();\n    // const flavour = utils.getItemFromStorage('flavour');\n    if (token) {\n      const currentTokenUser = jwtDecode(token.session);\n      // dispatch(setFlavour({ flavour: JSON.parse(flavour) }));\n      dispatch(setAuthDetail({\n        user: currentTokenUser,\n        token\n      }));\n      setIsTokenChecked(false);\n    } else {\n      setIsTokenChecked(false);\n      if (isSSO) {\n        dispatch(setTokens({\n          token: null\n        }));\n      }\n    }\n  };\n  const showMessage = async (message, color) => {\n    dispatch(openSnackbar({\n      open: true,\n      message: message,\n      variant: 'alert',\n      alert: {\n        color: color\n      },\n      close: true\n    }));\n  };\n  const AuthLoader = () => /*#__PURE__*/_jsxDEV(Box, {\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    height: \"100vh\",\n    children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n      size: 60,\n      color: 'success'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h6\",\n      sx: {\n        marginTop: 2\n      },\n      children: \"Authenticating, please wait...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 104,\n    columnNumber: 5\n  }, this);\n  if (isTokenChecked) {\n    return /*#__PURE__*/_jsxDEV(AuthLoader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(ThemeCustomization, {\n    children: /*#__PURE__*/_jsxDEV(Locales, {\n      children: /*#__PURE__*/_jsxDEV(ScrollTop, {\n        children: [/*#__PURE__*/_jsxDEV(Routes, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Snackbar, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 117,\n    columnNumber: 5\n  }, this);\n};\n_s(App, \"PjdJU8nRVOMgL+GUWqRphVfbsFI=\", false, function () {\n  return [useDispatch, useSelector, useConfig];\n});\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["useEffect","useState","jwtDecode","useDispatch","useSelector","Box","CircularProgress","Typography","Snackbar","Locales","ScrollTop","Routes","ApiService","setAuthDetail","setFlavour","setTokens","ThemeCustomization","utils","setCameraConfig","setTenant","openSnackbar","useConfig","jsxDEV","_jsxDEV","App","_s","dispatch","isLoading","state","auth","isTokenChecked","setIsTokenChecked","onChangePresetColor","getTentant","bindInitData","window","addEventListener","handleMessage","removeEventListener","data","getTenantsAsync","tenants","event","refreshToken","flavour","setItemToStorage","JSON","stringify","renewSession","error","renewSessionAsync","token","session","sessionToken","refresh","setTokensToStorage","localStorage","setItem","user","phone","currentTokenUser","showMessage","email","console","debug","isSSO","getTokensFromStorage","message","color","open","variant","alert","close","AuthLoader","display","flexDirection","justifyContent","alignItems","height","children","size","fileName","_jsxFileName","lineNumber","columnNumber","sx","marginTop","_c","$RefreshReg$"],"sources":["/home/harshad/OrderKey-Hub/drive-thru/UI/src/App.js"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport jwtDecode from 'jwt-decode';\nimport { useDispatch, useSelector } from 'react-redux';\n\n// Global Imports\nimport 'service/AxiosService';\n\n// Project Imports\nimport { Box, CircularProgress, Typography } from '@mui/material';\nimport Snackbar from 'components/@extended/Snackbar';\nimport Locales from 'components/Locales';\nimport ScrollTop from 'components/ScrollTop';\nimport Routes from 'routes';\nimport ApiService from 'service/ApiService';\nimport { setAuthDetail, setFlavour, setTokens } from 'store/reducers/auth';\nimport ThemeCustomization from 'themes';\nimport utils from 'utils/utils';\nimport { setCameraConfig, setTenant } from 'store/reducers/lookup';\nimport { openSnackbar } from 'store/reducers/snackbar';\nimport useConfig from 'hooks/useConfig';\n\n\nconst App = () => {\n  const dispatch = useDispatch();\n  const { isLoading } = useSelector((state) => state.auth);\n  const [isTokenChecked, setIsTokenChecked] = useState(isLoading);\n\n  const { onChangePresetColor } = useConfig();\n\n  useEffect(() => {\n    getTentant();\n    bindInitData(false);\n    window.addEventListener('message', handleMessage);\n    return () => window.removeEventListener('message', handleMessage);\n  }, []);\n\n  const getTentant = async () => {\n    const { data } = await ApiService.getTenantsAsync();\n    if (data) {\n      dispatch(setTenant({ tenants: data }));\n    }\n  };\n\n  const handleMessage = async (event) => {\n    if (event.data.refreshToken && event.data.flavour) {\n      dispatch(setFlavour({ flavour: event.data.flavour }));\n      utils.setItemToStorage('flavour', JSON.stringify(event.data.flavour));\n      await renewSession(event.data.refreshToken);\n      bindInitData(true);\n      onChangePresetColor(`theme1`);\n    }\n  };\n\n  const renewSession = async (refreshToken) => {\n    try {\n      const { data, error } = await ApiService.renewSessionAsync({ refreshToken });\n      if (data) {\n        const token = { session: data.sessionToken, refresh: data.refreshToken };\n        utils.setTokensToStorage(token);\n        localStorage.setItem('phone', data.user.phone);\n        const currentTokenUser = jwtDecode(token.session);\n        dispatch(setAuthDetail({ user: currentTokenUser, token }));\n      } else if (error) {\n        showMessage(error.email, 'error');\n      }\n    } catch (error) {\n      console.debug('generate session token issue : ', error);\n    } finally {\n      setIsTokenChecked(false);\n    }\n  };\n\n  const bindInitData = async (isSSO) => {\n    const token = utils.getTokensFromStorage();\n    // const flavour = utils.getItemFromStorage('flavour');\n    if (token) {\n      const currentTokenUser = jwtDecode(token.session);\n      // dispatch(setFlavour({ flavour: JSON.parse(flavour) }));\n      dispatch(setAuthDetail({ user: currentTokenUser, token }));\n      setIsTokenChecked(false);\n    } else {\n      setIsTokenChecked(false);\n      if (isSSO) {\n        dispatch(setTokens({ token: null }));\n      }\n    }\n  };\n\n  const showMessage = async (message, color) => {\n    dispatch(\n      openSnackbar({\n        open: true,\n        message: message,\n        variant: 'alert',\n        alert: {\n          color: color\n        },\n        close: true\n      })\n    );\n  };\n\n  const AuthLoader = () => (\n    <Box display='flex' flexDirection='column' justifyContent='center' alignItems='center' height='100vh'>\n      <CircularProgress size={60} color={'success'} />\n      <Typography variant='h6' sx={{ marginTop: 2 }}>\n        Authenticating, please wait...\n      </Typography>\n    </Box>\n  );\n\n  if (isTokenChecked) {\n    return <AuthLoader />;\n  }\n\n  return (\n    <ThemeCustomization>\n      <Locales>\n        <ScrollTop>\n          <Routes />\n          <Snackbar />\n        </ScrollTop>\n      </Locales>\n    </ThemeCustomization>\n  );\n};\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}