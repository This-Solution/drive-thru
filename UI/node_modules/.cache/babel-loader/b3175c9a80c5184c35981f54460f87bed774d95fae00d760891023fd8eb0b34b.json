{"ast":null,"code":"var _jsxFileName = \"/home/harshad/OrderKey-Hub/drive-thru/UI/src/contexts/StompContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// context/StompContext.tsx\nimport { Client } from '@stomp/stompjs';\nimport { createContext, useContext, useEffect, useRef, useState } from 'react';\nimport constants from 'utils/constants';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst StompContext = /*#__PURE__*/createContext(undefined);\nexport const StompProvider = ({\n  children\n}) => {\n  _s();\n  const [errorMessage, setErrorMessage] = useState('');\n  const [orderWindow, setOrderWindow] = useState({});\n  const [cameraName, setCameraName] = useState('');\n  const [deliveryWindow, setDeliveryWindow] = useState({});\n  const [client, setClient] = useState(null);\n  const clientRef = useRef(null);\n  useEffect(() => {\n    if (client) {\n      client.subscribe('/topic/send', handleMessage);\n    }\n  }, [client]);\n  const handleMessage = message => {\n    if (!message.body) return;\n    try {\n      var _response$cameraType, _response$cameraName, _response$carPlateNum, _response$carPlateNum2;\n      const response = JSON.parse(message.body);\n      const cameraType = (_response$cameraType = response.cameraType) !== null && _response$cameraType !== void 0 ? _response$cameraType : '';\n      const cameraName = (_response$cameraName = response.cameraName) !== null && _response$cameraName !== void 0 ? _response$cameraName : '';\n      const carPlateNumber = (_response$carPlateNum = (_response$carPlateNum2 = response.carPlateNumber) === null || _response$carPlateNum2 === void 0 ? void 0 : _response$carPlateNum2.toString()) !== null && _response$carPlateNum !== void 0 ? _response$carPlateNum : '';\n      if (cameraType === 'L') {\n        setOrderWindow({\n          ...orderWindow,\n          [cameraName]: carPlateNumber\n        });\n        setCameraName(cameraName);\n      } else if (cameraType === 'C') {\n        setDeliveryWindow({\n          ...deliveryWindow,\n          [cameraName]: carPlateNumber\n        });\n        setCameraName(cameraName);\n      }\n    } catch (e) {\n      console.error('Error decoding STOMP message:', e);\n    }\n  };\n  useEffect(() => {\n    const client = new Client({\n      brokerURL: constants.webSocketUrl,\n      reconnectDelay: 5000,\n      debug: msg => console.log('DEBUG:', msg),\n      onConnect: () => {\n        console.log('Connected to WebSocket server!');\n        setClient(client);\n      },\n      onStompError: frame => {\n        console.error('Broker reported error: ' + frame.headers['message']);\n        console.error('Additional details: ' + frame.body);\n      },\n      onWebSocketClose: event => {\n        console.log('WebSocket closed:', event);\n      },\n      onWebSocketError: event => {\n        console.error('WebSocket error:', event);\n      }\n    });\n    client.activate();\n    return () => {\n      client.deactivate();\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(StompContext.Provider, {\n    value: {\n      orderWindow,\n      deliveryWindow,\n      errorMessage,\n      cameraName,\n      clientRef\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 5\n  }, this);\n};\n_s(StompProvider, \"SDCJNeICyQdZ8KGpSuoKb4basjo=\");\n_c = StompProvider;\nexport const useStomp = () => {\n  _s2();\n  const ctx = useContext(StompContext);\n  if (!ctx) {\n    throw new Error('useStomp must be used within a StompProvider');\n  }\n  return ctx;\n};\n_s2(useStomp, \"/dMy7t63NXD4eYACoT93CePwGrg=\");\nvar _c;\n$RefreshReg$(_c, \"StompProvider\");","map":{"version":3,"names":["Client","createContext","useContext","useEffect","useRef","useState","constants","jsxDEV","_jsxDEV","StompContext","undefined","StompProvider","children","_s","errorMessage","setErrorMessage","orderWindow","setOrderWindow","cameraName","setCameraName","deliveryWindow","setDeliveryWindow","client","setClient","clientRef","subscribe","handleMessage","message","body","_response$cameraType","_response$cameraName","_response$carPlateNum","_response$carPlateNum2","response","JSON","parse","cameraType","carPlateNumber","toString","e","console","error","brokerURL","webSocketUrl","reconnectDelay","debug","msg","log","onConnect","onStompError","frame","headers","onWebSocketClose","event","onWebSocketError","activate","deactivate","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useStomp","_s2","ctx","Error","$RefreshReg$"],"sources":["/home/harshad/OrderKey-Hub/drive-thru/UI/src/contexts/StompContext.js"],"sourcesContent":["// context/StompContext.tsx\nimport { Client } from '@stomp/stompjs';\nimport { createContext, useContext, useEffect, useRef, useState } from 'react';\nimport constants from 'utils/constants';\n\nconst StompContext = createContext(undefined);\n\nexport const StompProvider = ({ children }) => {\n  const [errorMessage, setErrorMessage] = useState('');\n  const [orderWindow, setOrderWindow] = useState({});\n  const [cameraName, setCameraName] = useState('');\n  const [deliveryWindow, setDeliveryWindow] = useState({});\n  const [client, setClient] = useState(null);\n\n\n  const clientRef = useRef(null);\n\n  useEffect(() => {\n    if (client) {\n      client.subscribe('/topic/send', handleMessage)\n    }\n  }, [client])\n\n  const handleMessage = (message) => {\n    if (!message.body) return;\n    try {\n      const response = JSON.parse(message.body);\n      const cameraType = response.cameraType ?? '';\n      const cameraName = response.cameraName ?? '';\n      const carPlateNumber = response.carPlateNumber?.toString() ?? '';\n\n      if (cameraType === 'L') {\n        setOrderWindow({ ...orderWindow, [cameraName]: carPlateNumber });\n        setCameraName(cameraName);\n      } else if (cameraType === 'C') {\n        setDeliveryWindow({ ...deliveryWindow, [cameraName]: carPlateNumber })\n        setCameraName(cameraName);\n      }\n    } catch (e) {\n      console.error('Error decoding STOMP message:', e);\n    }\n  };\n\n  useEffect(() => {\n    const client = new Client({\n      brokerURL: constants.webSocketUrl,\n      reconnectDelay: 5000,\n      debug: (msg) => console.log('DEBUG:', msg),\n\n      onConnect: () => {\n        console.log('Connected to WebSocket server!');\n        setClient(client);\n      },\n\n      onStompError: (frame) => {\n        console.error('Broker reported error: ' + frame.headers['message']);\n        console.error('Additional details: ' + frame.body);\n      },\n\n      onWebSocketClose: (event) => {\n        console.log('WebSocket closed:', event);\n      },\n      onWebSocketError: (event) => {\n        console.error('WebSocket error:', event);\n      }\n    });\n\n    client.activate();\n\n    return () => {\n      client.deactivate();\n    };\n  }, []);\n\n  return (\n    <StompContext.Provider\n      value={{\n        orderWindow,\n        deliveryWindow,\n        errorMessage,\n        cameraName,\n        clientRef\n      }}\n    >\n      {children}\n    </StompContext.Provider>\n  );\n};\n\nexport const useStomp = () => {\n  const ctx = useContext(StompContext);\n  if (!ctx) {\n    throw new Error('useStomp must be used within a StompProvider');\n  }\n  return ctx;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}